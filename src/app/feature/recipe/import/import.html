<app-page heading="Importer une recette">
  @let recipes = similarRecipes() ?? [];

  @if (recipes.length > 0) {
    <app-section heading="Recettes similaires existantes">
      @for (recipe of recipes; track recipe.id) {
        <div>
          <a [href]="recipe.url" target="_blank">{{ recipe.name }}</a>
        </div>
      }
    </app-section>
  }

  <app-section heading="Résumé">
    <form [formGroup]="form" (ngSubmit)="import()" appForm>
      <div class="h-container">
        <div class="metadata-container">
          <div class="row">
            <app-control-container>
              <input formControlName="name" appNativeControl />

              @if (form.controls.name.invalid) {
                <app-control-error>Requis</app-control-error>
              }
            </app-control-container>
          </div>

          <div class="row">
            <label>#</label>
            <app-portions-counter formControlName="portionsCount" />
          </div>
        </div>

        <div class="illustration-wrapper">
          <img [ngSrc]="scrapResult().illustrationUrl" fill priority alt="" draggable="false" />
        </div>
      </div>

      <div class="row">
        <app-control-container>
          <textarea appNativeControl formControlName="instructions"></textarea>

          @if (form.controls.instructions.invalid) {
            <app-control-error>Requis</app-control-error>
          }
        </app-control-container>
      </div>

      <div class="submit-row">
        <button [disabled]="importing() || form.invalid" type="submit" appButton>Importer</button>
      </div>
    </form>
  </app-section>
</app-page>
